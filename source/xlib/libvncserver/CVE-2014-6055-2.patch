From: Martin T. H. Sandsmark <martin.sandsmark@kde.org>
Date: Tue, 23 Sep 2014 20:43:38 +0000
Subject: libnvcserver: Do not accept a scaling factor of zero.
X-Git-Url: http://quickgit.kde.org/?p=krfb.git&a=commitdiff&h=126a746dd7bee35840083e9bec7a52935a010346
---
libnvcserver: Do not accept a scaling factor of zero.

This would cause a division by zero and crash the server.

Upstream commit: 05a9bd41a8ec0a9d580a8f420f41718bdd235446
---


--- a/libvncserver/rfbserver.c
+++ b/libvncserver/rfbserver.c
@@ -2428,6 +2428,11 @@
           rfbCloseClient(cl);
           return;
       }
+      if (msg.ssc.scale == 0) {
+          rfbLogPerror("rfbProcessClientNormalMessage: will not accept a scale factor of zero");
+          rfbCloseClient(cl);
+          return;
+      }
       rfbStatRecordMessageRcvd(cl, msg.type, sz_rfbSetScaleMsg, sz_rfbSetScaleMsg);
       rfbLog("rfbSetScale(%d)\n", msg.ssc.scale);
       rfbScalingSetup(cl,cl->screen->width/msg.ssc.scale, cl->screen->height/msg.ssc.scale);
@@ -2441,6 +2446,11 @@
           sz_rfbSetScaleMsg - 1)) <= 0) {
           if (n != 0)
             rfbLogPerror("rfbProcessClientNormalMessage: read");
+          rfbCloseClient(cl);
+          return;
+      }
+      if (msg.ssc.scale == 0) {
+          rfbLogPerror("rfbProcessClientNormalMessage: will not accept a scale factor of zero");
           rfbCloseClient(cl);
           return;
       }
