Description: the id variable is not sanitized in host.php
 allowing cross site scripting and SQL injection
Author: xistence
Author: cigamit <cigamit@cacti.net>
Bug: http://bugs.cacti.net/view.php?id=2383
Bug-CVE: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-5588
Bug-CVE: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-5589
Applied-Upstream: http://svn.cacti.net/viewvc?view=rev&revision=7420

--- a/host.php
+++ b/host.php
@@ -149,6 +149,9 @@
 		if ($_POST["snmp_version"] == 3 && ($_POST["snmp_password"] != $_POST["snmp_password_confirm"])) {
 			raise_message(4);
 		}else{
+			input_validate_input_number(get_request_var_post("id"));
+			input_validate_input_number(get_request_var_post("host_template_id"));
+
 			$host_id = api_device_save($_POST["id"], $_POST["host_template_id"], $_POST["description"],
 				trim($_POST["hostname"]), $_POST["snmp_community"], $_POST["snmp_version"],
 				$_POST["snmp_username"], $_POST["snmp_password"],
--- a/lib/api_device.php
+++ b/lib/api_device.php
@@ -107,7 +107,7 @@
 		$_host_template_id = db_fetch_cell("select host_template_id from host where id=$id");
 	}
 
-	$save["id"] = $id;
+	$save["id"]                   = form_input_validate($id, "id", "^[0-9]+$", false, 3);
 	$save["host_template_id"]     = form_input_validate($host_template_id, "host_template_id", "^[0-9]+$", false, 3);
 	$save["description"]          = form_input_validate($description, "description", "", false, 3);
 	$save["hostname"]             = form_input_validate(trim($hostname), "hostname", "", false, 3);
