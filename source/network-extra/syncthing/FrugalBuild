# Compiling Time: 0.01 SBU
# Maintainer: DeX77 <dex77@frugalware.org>

pkgname=syncthing
pkgver=0.10.0
pkgrel=1
pkgdesc="Open Source Continuous Replication / Cluster Synchronization Thing"
url="http://syncthing.net/"
groups=('network-extra')
license=('MIT')
archs=('i686' 'x86_64')
depends=('glibc')
makedepends=('go' 'ca-certificates' 'mercurial' 'git')
_F_github_author="$pkgname"
_F_github_name="$pkgname"
_F_github_tag="y"
_F_github_ver="v${pkgver}"
_F_scm_type=git
_F_scm_url=https://github.com/$_F_github_author/$_F_github_name
_F_scm_tag="$_F_github_ver"
_F_systemd_units="syncthing="
_F_archive_grepv="beta"
Finclude scm github systemd
_F_cd_path="src/github.com/syncthing/syncthing"
up2date="$up2date | sed 's/v//'"
source=("syncthing@.service" )
sha1sums=('204cad3823306c793a14a17a23220e26199160d4')

build() {
	Funpack_scm

	cd .. || Fdie

	rm -rf src/github.com/syncthing/ || Fdie
	mkdir -p src/github.com/syncthing/ || Fdie
	mv "$pkgname" src/github.com/syncthing/syncthing || Fdie

	Fcd

	export GOPATH="$Fsrcdir"
	export PATH=$PATH:$GOROOT/bin
	
	# cover and vet are installed via go package
	sed -i '/cmd\/cover/d' build.go || Fdie
        sed -i '/cmd\/vet/d' build.go || Fdie

	./build.sh noupgrade || Fdie

	Fexe src/github.com/syncthing/syncthing/syncthing /usr/bin/syncthing

	Finstall 644 "/usr/lib/systemd/system/${pkgname}@.service"

}

